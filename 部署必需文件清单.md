# AWS RAG åº”ç”¨éƒ¨ç½²å¿…éœ€æ–‡ä»¶å®Œæ•´æ¸…å•

## ğŸ¯ æ ¸å¿ƒéƒ¨ç½²æ–‡ä»¶ï¼ˆæ²¡æœ‰è¿™äº›æ–‡ä»¶æ— æ³•éƒ¨ç½²ï¼‰

### 1. ä¸»æ§åˆ¶æ–‡ä»¶
```
ğŸ“ æ ¹ç›®å½•/
â”œâ”€â”€ ğŸ“„ Makefile                              # éƒ¨ç½²è‡ªåŠ¨åŒ–ä¸»è„šæœ¬ï¼ˆæœ€é‡è¦ï¼‰
â”œâ”€â”€ ğŸ“„ .env                                  # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¿…é¡»é…ç½®ï¼‰
â”œâ”€â”€ ğŸ“„ .env.example                          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ requirements.txt                      # Pythonä¾èµ–
â”œâ”€â”€ ğŸ“„ requirements-dev.txt                  # å¼€å‘ä¾èµ–
â”œâ”€â”€ ğŸ“„ requirements-lambda.txt               # Lambdaä¸“ç”¨ä¾èµ–
â””â”€â”€ ğŸ“„ Dockerfile.lambda                     # Lambdaå®¹å™¨é•œåƒå®šä¹‰
```

### 2. CDKåŸºç¡€è®¾æ–½æ–‡ä»¶ï¼ˆåˆ›å»ºAWSèµ„æºï¼‰
```
ğŸ“ infrastructure/
â”œâ”€â”€ ğŸ“„ app.py                                # CDKä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ ğŸ“„ app_v2.py                            # CDK V2åº”ç”¨ï¼ˆå¸¦CORSä¿®å¤ï¼‰
â”œâ”€â”€ ğŸ“„ requirements.txt                      # CDKä¾èµ–
â”œâ”€â”€ ğŸ“„ cdk.json                             # CDKé…ç½®
â”œâ”€â”€ ğŸ“„ cdk.context.json                     # CDKä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ ğŸ“ stacks/                              # CDKæ ˆå®šä¹‰
    â”œâ”€â”€ ğŸ“„ __init__.py
    â”œâ”€â”€ ğŸ“„ rag_data_stack.py                # æ•°æ®æ ˆï¼ˆS3ã€DynamoDBï¼‰
    â”œâ”€â”€ ğŸ“„ rag_api_stack.py                 # APIæ ˆV1
    â”œâ”€â”€ ğŸ“„ rag_api_stack_v2.py              # APIæ ˆV2ï¼ˆæ¨èï¼‰
    â””â”€â”€ ğŸ“„ rag_web_stack.py                 # Webæ ˆï¼ˆCloudFrontï¼‰
```

### 3. Lambdaå‡½æ•°ä»£ç 
```
ğŸ“ app/
â”œâ”€â”€ ğŸ“„ __init__.py
â”œâ”€â”€ ğŸ“ controllers/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“ lambda_handlers/                 # Lambdaå¤„ç†å™¨
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“„ query_handler.py             # æŸ¥è¯¢å¤„ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚       â”œâ”€â”€ ğŸ“„ query_handler_v2.py          # æŸ¥è¯¢å¤„ç†å™¨V2
â”‚       â”œâ”€â”€ ğŸ“„ ingest_handler.py            # æ–‡æ¡£æ‘„å…¥å¤„ç†å™¨
â”‚       â”œâ”€â”€ ğŸ“„ cors_helper.py              # CORSè¾…åŠ©å‡½æ•°
â”‚       â”œâ”€â”€ ğŸ“„ health_handler.py           # å¥åº·æ£€æŸ¥
â”‚       â””â”€â”€ ğŸ“„ Dockerfile                   # Lambdaå®¹å™¨Dockerfile
â”‚
â”œâ”€â”€ ğŸ“ models/                              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ document.py                     # æ–‡æ¡£æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ embedding.py                    # åµŒå…¥æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“„ vector_store.py                 # å‘é‡å­˜å‚¨
â”‚   â”œâ”€â”€ ğŸ“„ llm.py                         # LLMæ¥å£
â”‚   â”œâ”€â”€ ğŸ“„ rag_chain.py                   # RAGé“¾
â”‚   â”œâ”€â”€ ğŸ“„ simple_rag.py                   # ç®€å•RAGå®ç°
â”‚   â””â”€â”€ ğŸ“„ bedrock_client.py              # Bedrockå®¢æˆ·ç«¯
â”‚
â””â”€â”€ ğŸ“ views/
    â””â”€â”€ ğŸ“ web/                            # Webå‰ç«¯
        â”œâ”€â”€ ğŸ“„ index.html                  # ä¸»é¡µé¢
        â”œâ”€â”€ ğŸ“„ config.json                 # å‰ç«¯é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
        â”œâ”€â”€ ğŸ“„ styles.css                  # æ ·å¼ï¼ˆå¯é€‰ï¼‰
        â””â”€â”€ ğŸ“„ app.js                      # JavaScriptï¼ˆå¯é€‰ï¼‰
```

### 4. æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
```
ğŸ“ scripts/
â”œâ”€â”€ ğŸ“„ build_lambda_package.sh             # Lambda ZIPåŒ…æ„å»ºè„šæœ¬
â”œâ”€â”€ ğŸ“„ build_lambdas.sh                    # æ‰¹é‡æ„å»ºLambda
â”œâ”€â”€ ğŸ“„ generate_frontend_config.py         # ç”Ÿæˆå‰ç«¯é…ç½®
â”œâ”€â”€ ğŸ“„ deploy.py                           # Pythonéƒ¨ç½²è„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ ğŸ“„ test_deployment.py                  # éƒ¨ç½²æµ‹è¯•è„šæœ¬
â””â”€â”€ ğŸ“„ cleanup.sh                          # æ¸…ç†è„šæœ¬
```

### 5. Dockerç›¸å…³æ–‡ä»¶
```
ğŸ“ æ ¹ç›®å½•/
â”œâ”€â”€ ğŸ“„ Dockerfile.lambda                    # Lambdaå®¹å™¨å®šä¹‰
â”œâ”€â”€ ğŸ“„ docker-compose.yml                  # Dockerç»„åˆï¼ˆå¯é€‰ï¼‰
â””â”€â”€ ğŸ“„ .dockerignore                       # Dockerå¿½ç•¥æ–‡ä»¶
```

### 6. é…ç½®æ–‡ä»¶
```
ğŸ“ config/                                  # é…ç½®ç›®å½•ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ ğŸ“„ settings.py                         # åº”ç”¨è®¾ç½®
â”œâ”€â”€ ğŸ“„ aws.yaml                           # AWSé…ç½®
â”œâ”€â”€ ğŸ“„ zilliz.yaml                        # Zillizé…ç½®
â””â”€â”€ ğŸ“„ database.yaml                      # æ•°æ®åº“é…ç½®

ğŸ“ æ ¹ç›®å½•/
â”œâ”€â”€ ğŸ“„ .env                                # ç¯å¢ƒå˜é‡ï¼ˆå…³é”®ï¼‰
â”œâ”€â”€ ğŸ“„ .env.example                        # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ ğŸ“„ .gitignore                         # Gitå¿½ç•¥é…ç½®
```

### 7. æ–‡æ¡£æ–‡ä»¶ï¼ˆæŒ‡å¯¼éƒ¨ç½²ï¼‰
```
ğŸ“ æ ¹ç›®å½•/
â”œâ”€â”€ ğŸ“„ README.md                           # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ğŸ“„ CLAUDE.md                          # ClaudeæŒ‡å¯¼æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ DEPLOYMENT.md                      # éƒ¨ç½²æŒ‡å—ï¼ˆå¦‚æœæœ‰ï¼‰
â””â”€â”€ ğŸ“ docs/
    â”œâ”€â”€ ğŸ“„ architecture.md                # æ¶æ„è¯´æ˜
    â”œâ”€â”€ ğŸ“„ api.md                         # APIæ–‡æ¡£
    â””â”€â”€ ğŸ“„ troubleshooting.md            # æ•…éšœæ’é™¤
```

### 8. æµ‹è¯•æ–‡ä»¶ï¼ˆéªŒè¯éƒ¨ç½²ï¼‰
```
ğŸ“ tests/
â”œâ”€â”€ ğŸ“„ __init__.py
â”œâ”€â”€ ğŸ“„ test_lambda.py                     # Lambdaæµ‹è¯•
â”œâ”€â”€ ğŸ“„ test_api.py                        # APIæµ‹è¯•
â”œâ”€â”€ ğŸ“„ test_deployment.py                 # éƒ¨ç½²æµ‹è¯•
â””â”€â”€ ğŸ“„ test_ui_functionality.py          # UIæµ‹è¯•
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### å¿…é¡»å­˜åœ¨çš„æ–‡ä»¶ï¼ˆç¼ºä¸€ä¸å¯ï¼‰
- [ ] âœ… Makefile
- [ ] âœ… .envï¼ˆé…ç½®æ­£ç¡®ï¼‰
- [ ] âœ… infrastructure/app_v2.py
- [ ] âœ… infrastructure/stacks/rag_data_stack.py
- [ ] âœ… infrastructure/stacks/rag_api_stack_v2.py
- [ ] âœ… infrastructure/stacks/rag_web_stack.py
- [ ] âœ… app/controllers/lambda_handlers/query_handler.py
- [ ] âœ… app/controllers/lambda_handlers/ingest_handler.py
- [ ] âœ… app/views/web/index.html
- [ ] âœ… scripts/build_lambda_package.sh
- [ ] âœ… scripts/generate_frontend_config.py

### å®¹å™¨éƒ¨ç½²å¿…éœ€ï¼ˆæ¨èæ–¹å¼ï¼‰
- [ ] âœ… Dockerfile.lambda
- [ ] âœ… requirements-lambda.txt
- [ ] âœ… app/controllers/lambda_handlers/Dockerfile

### ZIPéƒ¨ç½²å¿…éœ€ï¼ˆå¤‡é€‰æ–¹å¼ï¼‰
- [ ] âœ… scripts/build_lambda_package.sh
- [ ] âœ… requirements.txt

## ğŸ”§ éƒ¨ç½²å‰éªŒè¯å‘½ä»¤

```bash
# 1. æ£€æŸ¥æ‰€æœ‰å¿…éœ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
for file in Makefile .env infrastructure/app_v2.py; do
  [ -f "$file" ] && echo "âœ… $file" || echo "âŒ $file ç¼ºå¤±"
done

# 2. éªŒè¯ç¯å¢ƒå˜é‡
grep -E "ZILLIZ_TOKEN|ZILLIZ_ENDPOINT|AWS_REGION" .env

# 3. æ£€æŸ¥Pythonä¾èµ–
pip list | grep -E "boto3|pymilvus|aws-cdk-lib"

# 4. éªŒè¯Dockerï¼ˆå®¹å™¨éƒ¨ç½²ï¼‰
docker --version && echo "âœ… Dockerå·²å®‰è£…"

# 5. éªŒè¯AWS CLI
aws sts get-caller-identity && echo "âœ… AWSé…ç½®æ­£ç¡®"
```

## ğŸš€ ä¸€é”®éƒ¨ç½²å‘½ä»¤åºåˆ—

```bash
# å®Œæ•´éƒ¨ç½²ï¼ˆå®¹å™¨é•œåƒæ–¹å¼ - æ¨èï¼‰
make deploy

# æˆ–åˆ†æ­¥éƒ¨ç½²
make check-env          # æ£€æŸ¥ç¯å¢ƒ
make bootstrap          # åˆå§‹åŒ–CDKï¼ˆé¦–æ¬¡ï¼‰
make build-container    # æ„å»ºå®¹å™¨
make push-container     # æ¨é€åˆ°ECR
make deploy            # éƒ¨ç½²æ‰€æœ‰æ ˆ
make test-lambda       # æµ‹è¯•éƒ¨ç½²

# ZIPåŒ…éƒ¨ç½²ï¼ˆå¤‡é€‰ï¼‰
make build-lambda-fixed
make deploy-lambda-direct
```

## ğŸ“Š æ–‡ä»¶ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•°é‡ | å…³é”®ç¨‹åº¦ |
|------|---------|---------|
| é…ç½®æ–‡ä»¶ | 8 | â­â­â­â­â­ |
| CDKåŸºç¡€è®¾æ–½ | 9 | â­â­â­â­â­ |
| Lambdaä»£ç  | 15 | â­â­â­â­â­ |
| æ„å»ºè„šæœ¬ | 6 | â­â­â­â­â­ |
| å‰ç«¯æ–‡ä»¶ | 4 | â­â­â­â­ |
| Dockeræ–‡ä»¶ | 3 | â­â­â­â­ |
| æµ‹è¯•æ–‡ä»¶ | 5 | â­â­â­ |
| æ–‡æ¡£ | 5 | â­â­ |
| **æ€»è®¡** | **çº¦55ä¸ªæ–‡ä»¶** | - |

## âš ï¸ ç‰¹åˆ«æ³¨æ„

1. **.envæ–‡ä»¶**ï¼šå¿…é¡»æ­£ç¡®é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œç‰¹åˆ«æ˜¯ï¼š
   - ZILLIZ_TOKEN
   - ZILLIZ_ENDPOINT
   - AWS_REGION
   - BEDROCK_MODEL_ID

2. **æ–‡ä»¶æƒé™**ï¼š
   ```bash
   chmod 600 .env                          # ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
   chmod +x scripts/*.sh                   # è„šæœ¬å¯æ‰§è¡Œ
   ```

3. **ä¾èµ–ç‰ˆæœ¬**ï¼šç¡®ä¿ä¾èµ–ç‰ˆæœ¬å…¼å®¹
   - Python 3.9+
   - aws-cdk-lib>=2.100.0
   - boto3>=1.34.0
   - pymilvus>=2.3.0

4. **AWSæƒé™**ï¼šéœ€è¦ä»¥ä¸‹IAMæƒé™ï¼š
   - CloudFormationå…¨æƒé™
   - Lambdaåˆ›å»ºå’Œç®¡ç†
   - S3æ¡¶åˆ›å»ºå’Œç®¡ç†
   - API Gatewayç®¡ç†
   - CloudFrontåˆ†å‘
   - ECRä»“åº“ç®¡ç†
   - Bedrockæ¨¡å‹è®¿é—®

## ğŸ’¡ å¿«é€Ÿè¯Šæ–­

å¦‚æœéƒ¨ç½²å¤±è´¥ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. **ç¯å¢ƒå˜é‡**ï¼š`cat .env | grep -E "ZILLIZ|AWS_REGION|BEDROCK"`
2. **CDKæ ˆ**ï¼š`cd infrastructure && cdk list`
3. **LambdaåŒ…**ï¼š`ls -lh *.zip` æˆ– `docker images | grep rag`
4. **AWSå‡­è¯**ï¼š`aws sts get-caller-identity`
5. **æ ˆçŠ¶æ€**ï¼š`aws cloudformation list-stacks --query "StackSummaries[?contains(StackName, 'RAG')]"`

---

**æœ‰äº†è¿™äº›æ–‡ä»¶ï¼Œæ‚¨å°±èƒ½100%æˆåŠŸéƒ¨ç½²AWS RAGåº”ç”¨ï¼**

ç”Ÿæˆæ—¶é—´ï¼š2025-08-15