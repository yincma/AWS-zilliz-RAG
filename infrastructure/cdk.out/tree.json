{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.210.0"},"children":{"RAG-Data-prod":{"id":"RAG-Data-prod","path":"RAG-Data-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.210.0"},"children":{"DocumentBucket":{"id":"DocumentBucket","path":"RAG-Data-prod/DocumentBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Data-prod/DocumentBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"rag-documents-375004070918-us-east-1","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET","PUT","POST","DELETE"],"allowedOrigins":["*"]}]},"lifecycleConfiguration":{"rules":[{"id":"DeleteOldVersions","noncurrentVersionExpiration":{"noncurrentDays":30},"status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"RAG-Data-prod/DocumentBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Data-prod/DocumentBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"DocumentBucketAE41E5A9"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["DocumentBucketAE41E5A9","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DocumentBucketAE41E5A9","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"RAG-Data-prod/DocumentBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.210.0","metadata":[]},"children":{"Default":{"id":"Default","path":"RAG-Data-prod/DocumentBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"RAG-Data-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.210.0"},"children":{"Staging":{"id":"Staging","path":"RAG-Data-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"Role":{"id":"Role","path":"RAG-Data-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}},"Handler":{"id":"Handler","path":"RAG-Data-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"SessionTable":{"id":"SessionTable","path":"RAG-Data-prod/SessionTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Data-prod/SessionTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"session_id","attributeType":"S"},{"attributeName":"timestamp","attributeType":"N"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"session_id","keyType":"HASH"},{"attributeName":"timestamp","keyType":"RANGE"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":true},"tableName":"rag-sessions-prod","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeToLiveSpecification":{"attributeName":"ttl","enabled":true}}}},"ScalingRole":{"id":"ScalingRole","path":"RAG-Data-prod/SessionTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"DocumentMetadataTable":{"id":"DocumentMetadataTable","path":"RAG-Data-prod/DocumentMetadataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Data-prod/DocumentMetadataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"document_id","attributeType":"S"},{"attributeName":"user_id","attributeType":"S"},{"attributeName":"upload_date","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"user-index","keySchema":[{"attributeName":"user_id","keyType":"HASH"},{"attributeName":"upload_date","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"document_id","keyType":"HASH"}],"streamSpecification":{"streamViewType":"NEW_AND_OLD_IMAGES"},"tableName":"rag-document-metadata-prod","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"ScalingRole":{"id":"ScalingRole","path":"RAG-Data-prod/DocumentMetadataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"CDKMetadata":{"id":"CDKMetadata","path":"RAG-Data-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"RAG-Data-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"Exports":{"id":"Exports","path":"RAG-Data-prod/Exports","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Output{\"Fn::GetAtt\":[\"DocumentBucketAE41E5A9\",\"Arn\"]}":{"id":"Output{\"Fn::GetAtt\":[\"DocumentBucketAE41E5A9\",\"Arn\"]}","path":"RAG-Data-prod/Exports/Output{\"Fn::GetAtt\":[\"DocumentBucketAE41E5A9\",\"Arn\"]}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"Output{\"Ref\":\"DocumentBucketAE41E5A9\"}":{"id":"Output{\"Ref\":\"DocumentBucketAE41E5A9\"}","path":"RAG-Data-prod/Exports/Output{\"Ref\":\"DocumentBucketAE41E5A9\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"RAG-Data-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.210.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"RAG-Data-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.210.0"}}}},"RAG-API-prod":{"id":"RAG-API-prod","path":"RAG-API-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.210.0"},"children":{"LambdaExecutionRole":{"id":"LambdaExecutionRole","path":"RAG-API-prod/LambdaExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportLambdaExecutionRole":{"id":"ImportLambdaExecutionRole","path":"RAG-API-prod/LambdaExecutionRole/ImportLambdaExecutionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"RAG-API-prod/LambdaExecutionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"RAG-API-prod/LambdaExecutionRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/LambdaExecutionRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream"],"Effect":"Allow","Resource":"*"},{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputFnGetAttDocumentBucketAE41E5A9ArnF6A03022"},{"Fn::Join":["",[{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputFnGetAttDocumentBucketAE41E5A9ArnF6A03022"},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"LambdaExecutionRoleDefaultPolicy6D69732F","roles":[{"Ref":"LambdaExecutionRoleD5C26073"}]}}}}}}},"ECRRepoQuery":{"id":"ECRRepoQuery","path":"RAG-API-prod/ECRRepoQuery","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.210.0","metadata":[]}},"QueryFunction":{"id":"QueryFunction","path":"RAG-API-prod/QueryFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/QueryFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"imageUri":{"Fn::Join":["",["375004070918.dkr.ecr.us-east-1.",{"Ref":"AWS::URLSuffix"},"/rag-lambda-query:latest"]]}},"description":"RAG查询处理函数（容器版）","environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"imageConfig":{"command":["query_handler.handler"]},"memorySize":1024,"packageType":"Image","role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":30}}},"LogRetention":{"id":"LogRetention","path":"RAG-API-prod/QueryFunction/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.210.0"},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/QueryFunction/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"LogGroup":{"id":"LogGroup","path":"RAG-API-prod/QueryFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a":{"id":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Code":{"id":"Code","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"ServiceRole":{"id":"ServiceRole","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:DeleteRetentionPolicy","logs:PutRetentionPolicy"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB","roles":[{"Ref":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"}]}}}}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"ECRRepoIngest":{"id":"ECRRepoIngest","path":"RAG-API-prod/ECRRepoIngest","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.210.0","metadata":[]}},"IngestFunction":{"id":"IngestFunction","path":"RAG-API-prod/IngestFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/IngestFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"imageUri":{"Fn::Join":["",["375004070918.dkr.ecr.us-east-1.",{"Ref":"AWS::URLSuffix"},"/rag-lambda-query:latest"]]}},"description":"文档摄入处理函数（容器版）","environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"imageConfig":{"command":["ingest_handler.handler"]},"memorySize":2048,"packageType":"Image","role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":300}}},"LogRetention":{"id":"LogRetention","path":"RAG-API-prod/IngestFunction/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.210.0"},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/IngestFunction/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"LogGroup":{"id":"LogGroup","path":"RAG-API-prod/IngestFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"HealthFunction":{"id":"HealthFunction","path":"RAG-API-prod/HealthFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/HealthFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\nimport os\n\ndef handler(event, context):\n    # 获取CORS配置\n    allow_origins = os.environ.get('CORS_ALLOW_ORIGINS', '*')\n    allow_methods = os.environ.get('CORS_ALLOW_METHODS', 'GET,OPTIONS')\n    allow_headers = os.environ.get('CORS_ALLOW_HEADERS', 'Content-Type')\n    \n    return {\n        'statusCode': 200,\n        'headers': {\n            'Content-Type': 'application/json',\n            'Access-Control-Allow-Origin': allow_origins,\n            'Access-Control-Allow-Methods': allow_methods,\n            'Access-Control-Allow-Headers': allow_headers\n        },\n        'body': json.dumps({\n            'status': 'healthy',\n            'service': 'rag-api',\n            'timestamp': context.aws_request_id\n        })\n    }\n            "},"description":"健康检查函数","environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"handler":"index.handler","memorySize":128,"role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"runtime":"python3.9","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":5}}},"LogRetention":{"id":"LogRetention","path":"RAG-API-prod/HealthFunction/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.210.0"},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/HealthFunction/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"LogGroup":{"id":"LogGroup","path":"RAG-API-prod/HealthFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"RagApi":{"id":"RagApi","path":"RAG-API-prod/RagApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.RestApi","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnRestApi","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::RestApi","aws:cdk:cloudformation:props":{"description":"RAG应用API V2","name":"rag-api-prod","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"Deployment":{"id":"Deployment","path":"RAG-API-prod/RagApi/Deployment","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Deployment","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Deployment/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnDeployment","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Deployment","aws:cdk:cloudformation:props":{"description":"RAG应用API V2","restApiId":{"Ref":"RagApiDA20095C"}}}}}},"DeploymentStage.prod":{"id":"DeploymentStage.prod","path":"RAG-API-prod/RagApi/DeploymentStage.prod","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Stage","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/DeploymentStage.prod/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnStage","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Stage","aws:cdk:cloudformation:props":{"deploymentId":{"Ref":"RagApiDeploymentF0C2F69745d1dc0d7456643161ce3ebd001f73ea"},"methodSettings":[{"httpMethod":"*","resourcePath":"/*","dataTraceEnabled":true,"loggingLevel":"INFO","metricsEnabled":true,"throttlingBurstLimit":200,"throttlingRateLimit":100}],"restApiId":{"Ref":"RagApiDA20095C"},"stageName":"prod","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}}}},"Endpoint":{"id":"Endpoint","path":"RAG-API-prod/RagApi/Endpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"Default":{"id":"Default","path":"RAG-API-prod/RagApi/Default","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.ResourceBase","version":"2.210.0","metadata":[]},"children":{"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"health":{"id":"health","path":"RAG-API-prod/RagApi/Default/health","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/health/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"pathPart":"health","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/health/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/health/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApihealth5A7F792F"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"GET":{"id":"GET","path":"RAG-API-prod/RagApi/Default/health/GET","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..health":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..health","path":"RAG-API-prod/RagApi/Default/health/GET/ApiPermission.RAGAPIprodRagApiEA9262F2.GET..health","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["HealthFunction19D7724A","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/GET/health"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..health":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..health","path":"RAG-API-prod/RagApi/Default/health/GET/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..health","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["HealthFunction19D7724A","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/GET/health"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/health/GET/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"GET","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["HealthFunction19D7724A","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"RagApihealth5A7F792F"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}}}},"query":{"id":"query","path":"RAG-API-prod/RagApi/Default/query","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/query/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"pathPart":"query","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/query/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/query/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApiquery835A1EE8"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"POST":{"id":"POST","path":"RAG-API-prod/RagApi/Default/query/POST","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..query":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..query","path":"RAG-API-prod/RagApi/Default/query/POST/ApiPermission.RAGAPIprodRagApiEA9262F2.POST..query","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/POST/query"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..query":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..query","path":"RAG-API-prod/RagApi/Default/query/POST/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..query","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/POST/query"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/query/POST/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"POST","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST","timeoutInMillis":29000},"resourceId":{"Ref":"RagApiquery835A1EE8"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}}}},"documents":{"id":"documents","path":"RAG-API-prod/RagApi/Default/documents","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"pathPart":"documents","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/documents/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApidocumentsF1E1EF00"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"POST":{"id":"POST","path":"RAG-API-prod/RagApi/Default/documents/POST","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..documents":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..documents","path":"RAG-API-prod/RagApi/Default/documents/POST/ApiPermission.RAGAPIprodRagApiEA9262F2.POST..documents","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["IngestFunction4B2F2EB2","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/POST/documents"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..documents":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..documents","path":"RAG-API-prod/RagApi/Default/documents/POST/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..documents","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["IngestFunction4B2F2EB2","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/POST/documents"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/POST/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"POST","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["IngestFunction4B2F2EB2","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST","timeoutInMillis":29000},"resourceId":{"Ref":"RagApidocumentsF1E1EF00"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"GET":{"id":"GET","path":"RAG-API-prod/RagApi/Default/documents/GET","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..documents":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..documents","path":"RAG-API-prod/RagApi/Default/documents/GET/ApiPermission.RAGAPIprodRagApiEA9262F2.GET..documents","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ListDocsFunction22D59F26","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/GET/documents"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..documents":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..documents","path":"RAG-API-prod/RagApi/Default/documents/GET/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..documents","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ListDocsFunction22D59F26","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/GET/documents"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/GET/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"GET","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["ListDocsFunction22D59F26","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"RagApidocumentsF1E1EF00"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"{proxy+}":{"id":"{proxy+}","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Ref":"RagApidocumentsF1E1EF00"},"pathPart":"{proxy+}","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApidocumentsproxyD2218942"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"DELETE":{"id":"DELETE","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/DELETE","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/DELETE/ApiPermission.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["DeleteDocFunctionE3E59255","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/DELETE/documents/*"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/DELETE/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.DELETE..documents.{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["DeleteDocFunctionE3E59255","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/DELETE/documents/*"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/documents/{proxy+}/DELETE/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"DELETE","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["DeleteDocFunctionE3E59255","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"RagApidocumentsproxyD2218942"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}}}}}},"search":{"id":"search","path":"RAG-API-prod/RagApi/Default/search","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/search/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"pathPart":"search","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/search/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/search/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApisearchF16A6584"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"POST":{"id":"POST","path":"RAG-API-prod/RagApi/Default/search/POST","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..search":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.POST..search","path":"RAG-API-prod/RagApi/Default/search/POST/ApiPermission.RAGAPIprodRagApiEA9262F2.POST..search","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/POST/search"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..search":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..search","path":"RAG-API-prod/RagApi/Default/search/POST/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.POST..search","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/POST/search"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/search/POST/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"POST","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["QueryFunctionBDF4DE5B","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"RagApisearchF16A6584"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}}}},"stats":{"id":"stats","path":"RAG-API-prod/RagApi/Default/stats","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/stats/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["RagApiDA20095C","RootResourceId"]},"pathPart":"stats","restApiId":{"Ref":"RagApiDA20095C"}}}},"OPTIONS":{"id":"OPTIONS","path":"RAG-API-prod/RagApi/Default/stats/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/stats/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE,OPTIONS'","method.response.header.Access-Control-Max-Age":"'3600'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"RagApistats27511A80"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}},"GET":{"id":"GET","path":"RAG-API-prod/RagApi/Default/stats/GET","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.210.0","metadata":[]},"children":{"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..stats":{"id":"ApiPermission.RAGAPIprodRagApiEA9262F2.GET..stats","path":"RAG-API-prod/RagApi/Default/stats/GET/ApiPermission.RAGAPIprodRagApiEA9262F2.GET..stats","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["StatsFunctionE4A6FC3A","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/",{"Ref":"RagApiDeploymentStageprodF300773B"},"/GET/stats"]]}}}},"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..stats":{"id":"ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..stats","path":"RAG-API-prod/RagApi/Default/stats/GET/ApiPermission.Test.RAGAPIprodRagApiEA9262F2.GET..stats","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["StatsFunctionE4A6FC3A","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:375004070918:",{"Ref":"RagApiDA20095C"},"/test-invoke-stage/GET/stats"]]}}}},"Resource":{"id":"Resource","path":"RAG-API-prod/RagApi/Default/stats/GET/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"GET","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["StatsFunctionE4A6FC3A","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"RagApistats27511A80"},"restApiId":{"Ref":"RagApiDA20095C"}}}}}}}}}}}},"ListDocsFunction":{"id":"ListDocsFunction","path":"RAG-API-prod/ListDocsFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/ListDocsFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\nimport boto3\nimport os\n\ndef handler(event, context):\n    try:\n        s3 = boto3.client('s3')\n        bucket = os.environ.get('S3_BUCKET', '')\n        \n        # 列出文档\n        response = s3.list_objects_v2(\n            Bucket=bucket,\n            Prefix='documents/',\n            MaxKeys=100\n        )\n        \n        files = []\n        if 'Contents' in response:\n            files = [\n                {\n                    'name': obj['Key'].replace('documents/', ''),\n                    'size': obj['Size'],\n                    'modified': obj['LastModified'].isoformat()\n                }\n                for obj in response['Contents']\n            ]\n        \n        return {\n            'statusCode': 200,\n            'headers': {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': os.environ.get('CORS_ALLOW_ORIGINS', '*'),\n                'Access-Control-Allow-Methods': os.environ.get('CORS_ALLOW_METHODS', 'GET,OPTIONS'),\n                'Access-Control-Allow-Headers': os.environ.get('CORS_ALLOW_HEADERS', 'Content-Type')\n            },\n            'body': json.dumps({'documents': files})\n        }\n    except Exception as e:\n        return {\n            'statusCode': 500,\n            'headers': {\n                'Content-Type': 'application/json',\n                'Access-Control-Allow-Origin': '*'\n            },\n            'body': json.dumps({'error': str(e)})\n        }\n                    "},"environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"runtime":"python3.9","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":10}}}}},"DeleteDocFunction":{"id":"DeleteDocFunction","path":"RAG-API-prod/DeleteDocFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/DeleteDocFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\nimport boto3\nimport os\n\ndef handler(event, context):\n    # 获取CORS配置\n    allow_origins = os.environ.get('CORS_ALLOW_ORIGINS', '*')\n    allow_methods = os.environ.get('CORS_ALLOW_METHODS', 'GET,POST,PUT,DELETE,OPTIONS')\n    allow_headers = os.environ.get('CORS_ALLOW_HEADERS', 'Content-Type')\n    \n    cors_headers = {\n        'Access-Control-Allow-Origin': allow_origins,\n        'Access-Control-Allow-Methods': allow_methods,\n        'Access-Control-Allow-Headers': allow_headers\n    }\n    \n    try:\n        path_params = event.get('pathParameters', {})\n        doc_path = path_params.get('proxy', '')\n        \n        if not doc_path:\n            return {\n                'statusCode': 400,\n                'headers': {**cors_headers, 'Content-Type': 'application/json'},\n                'body': json.dumps({'error': 'Document path is required'})\n            }\n        \n        s3 = boto3.client('s3')\n        bucket = os.environ.get('S3_BUCKET', '')\n        s3_key = f\"documents/{doc_path}\" if not doc_path.startswith('documents/') else doc_path\n        \n        s3.delete_object(Bucket=bucket, Key=s3_key)\n        \n        # Try to delete embeddings\n        try:\n            embeddings_key = s3_key.replace('documents/', 'embeddings/') + '.json'\n            s3.delete_object(Bucket=bucket, Key=embeddings_key)\n        except:\n            pass\n        \n        return {\n            'statusCode': 200,\n            'headers': {**cors_headers, 'Content-Type': 'application/json'},\n            'body': json.dumps({\n                'status': 'success',\n                'message': 'Document deleted successfully',\n                'document': doc_path,\n                'zilliz_deleted': False  # Not supported in fallback mode\n            })\n        }\n        \n    except Exception as e:\n        return {\n            'statusCode': 500,\n            'headers': {**cors_headers, 'Content-Type': 'application/json'},\n            'body': json.dumps({\n                'status': 'error',\n                'error': str(e),\n                'message': 'Failed to delete document'\n            })\n        }\n                "},"description":"删除文档函数(基础版本)","environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"handler":"index.handler","memorySize":256,"role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"runtime":"python3.9","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":10}}},"LogRetention":{"id":"LogRetention","path":"RAG-API-prod/DeleteDocFunction/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.210.0"},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/DeleteDocFunction/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"LogGroup":{"id":"LogGroup","path":"RAG-API-prod/DeleteDocFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}}}},"StatsFunction":{"id":"StatsFunction","path":"RAG-API-prod/StatsFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-API-prod/StatsFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\nimport os\n\ndef handler(event, context):\n    # 返回默认统计信息\n    stats = {\n        'documents': 0,\n        'vectors': 0,\n        'dimension': 1536,\n        'collection': os.environ.get('ZILLIZ_COLLECTION', 'rag_collection'),\n        'status': 'operational'\n    }\n    \n    return {\n        'statusCode': 200,\n        'headers': {\n            'Content-Type': 'application/json',\n            'Access-Control-Allow-Origin': os.environ.get('CORS_ALLOW_ORIGINS', '*'),\n            'Access-Control-Allow-Methods': os.environ.get('CORS_ALLOW_METHODS', 'GET,OPTIONS'),\n            'Access-Control-Allow-Headers': os.environ.get('CORS_ALLOW_HEADERS', 'Content-Type')\n        },\n        'body': json.dumps(stats)\n    }\n                "},"environment":{"variables":{"S3_BUCKET":{"Fn::ImportValue":"RAG-Data-prod:ExportsOutputRefDocumentBucketAE41E5A9880EA18D"},"BEDROCK_MODEL_ID":"amazon.nova-pro-v1:0","EMBEDDING_MODEL_ID":"amazon.titan-embed-text-v1","ZILLIZ_ENDPOINT":"https://in03-a9b3b5529895a3d.serverless.aws-eu-central-1.cloud.zilliz.com","ZILLIZ_TOKEN":"88c6ee3f3abf448278a1e30d5b951517645207f1fa94daeec7fc7b7e4b47fbaeb2bc953e5d1ccb2e94749f8f3992955310026115","ZILLIZ_COLLECTION":"rag_collection","PYTHONPATH":"/var/task","CORS_ALLOW_ORIGINS":"*","CORS_ALLOW_METHODS":"GET,POST,PUT,DELETE,OPTIONS","CORS_ALLOW_HEADERS":"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token"}},"handler":"index.handler","memorySize":128,"role":{"Fn::GetAtt":["LambdaExecutionRoleD5C26073","Arn"]},"runtime":"python3.9","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":5}}}}},"ApiUrl":{"id":"ApiUrl","path":"RAG-API-prod/ApiUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"ApiId":{"id":"ApiId","path":"RAG-API-prod/ApiId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"QueryFunctionArn":{"id":"QueryFunctionArn","path":"RAG-API-prod/QueryFunctionArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"QueryFunctionName":{"id":"QueryFunctionName","path":"RAG-API-prod/QueryFunctionName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"IngestFunctionArn":{"id":"IngestFunctionArn","path":"RAG-API-prod/IngestFunctionArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"IngestFunctionName":{"id":"IngestFunctionName","path":"RAG-API-prod/IngestFunctionName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"RAG-API-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"RAG-API-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"Exports":{"id":"Exports","path":"RAG-API-prod/Exports","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Output{\"Ref\":\"RagApiDA20095C\"}":{"id":"Output{\"Ref\":\"RagApiDA20095C\"}","path":"RAG-API-prod/Exports/Output{\"Ref\":\"RagApiDA20095C\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"Output{\"Ref\":\"RagApiDeploymentStageprodF300773B\"}":{"id":"Output{\"Ref\":\"RagApiDeploymentStageprodF300773B\"}","path":"RAG-API-prod/Exports/Output{\"Ref\":\"RagApiDeploymentStageprodF300773B\"}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"RAG-API-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.210.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"RAG-API-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.210.0"}}}},"RAG-Web-prod":{"id":"RAG-Web-prod","path":"RAG-Web-prod","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.210.0"},"children":{"WebBucket":{"id":"WebBucket","path":"RAG-Web-prod/WebBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/WebBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"rag-web-375004070918-us-east-1","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET","HEAD"],"allowedOrigins":["*"],"exposedHeaders":[]}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"aws-cdk:cr-owned:9239111e","value":"true"},{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"Policy":{"id":"Policy","path":"RAG-Web-prod/WebBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/WebBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"WebBucket12880F5B"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},"/*"]]}]},{"Action":["s3:GetObject","s3:GetObjectVersion","s3:ListBucket"],"Effect":"Allow","Principal":{"CanonicalUser":{"Fn::GetAtt":["WebOAI6A7C4516","S3CanonicalUserId"]}},"Resource":[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},"/*"]]}],"Sid":"AllowCloudFrontOAIRead"},{"Action":"s3:GetObject","Effect":"Allow","Principal":{"CanonicalUser":{"Fn::GetAtt":["WebOAI6A7C4516","S3CanonicalUserId"]}},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},"/*"]]}}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"RAG-Web-prod/WebBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.210.0","metadata":[]},"children":{"Default":{"id":"Default","path":"RAG-Web-prod/WebBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"RAG-Web-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.210.0"},"children":{"Staging":{"id":"Staging","path":"RAG-Web-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"Role":{"id":"Role","path":"RAG-Web-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}},"Handler":{"id":"Handler","path":"RAG-Web-prod/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"WebOAI":{"id":"WebOAI","path":"RAG-Web-prod/WebOAI","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.OriginAccessIdentity","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/WebOAI/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnCloudFrontOriginAccessIdentity","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::CloudFrontOriginAccessIdentity","aws:cdk:cloudformation:props":{"cloudFrontOriginAccessIdentityConfig":{"comment":"OAI for RAG Web Application RAG-Web-prod"}}}}}},"ResponseHeadersPolicy":{"id":"ResponseHeadersPolicy","path":"RAG-Web-prod/ResponseHeadersPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.ResponseHeadersPolicy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/ResponseHeadersPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnResponseHeadersPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::ResponseHeadersPolicy","aws:cdk:cloudformation:props":{"responseHeadersPolicyConfig":{"name":"rag-web-headers-RAG-Web-prod","comment":"Response headers for RAG Web Application","corsConfig":{"accessControlAllowCredentials":false,"accessControlAllowHeaders":{"items":["*"]},"accessControlAllowMethods":{"items":["GET","HEAD","OPTIONS"]},"accessControlAllowOrigins":{"items":["*"]},"originOverride":true},"securityHeadersConfig":{"contentTypeOptions":{"override":true},"frameOptions":{"frameOption":"DENY","override":true},"referrerPolicy":{"override":true,"referrerPolicy":"strict-origin-when-cross-origin"},"strictTransportSecurity":{"accessControlMaxAge":{"amount":63072000,"unit":{"label":"seconds","isoLabel":"S","inMillis":1000}},"override":true,"includeSubdomains":true,"accessControlMaxAgeSec":63072000},"xssProtection":{"override":true,"protection":true,"modeBlock":true}}}}}}}},"CachePolicy":{"id":"CachePolicy","path":"RAG-Web-prod/CachePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CachePolicy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/CachePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnCachePolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::CachePolicy","aws:cdk:cloudformation:props":{"cachePolicyConfig":{"name":"rag-web-cache-RAG-Web-prod","comment":"Cache policy for RAG Web Application","minTtl":0,"maxTtl":31536000,"defaultTtl":86400,"parametersInCacheKeyAndForwardedToOrigin":{"cookiesConfig":{"cookieBehavior":"none"},"headersConfig":{"headerBehavior":"none"},"enableAcceptEncodingGzip":true,"enableAcceptEncodingBrotli":true,"queryStringsConfig":{"queryStringBehavior":"all"}}}}}}}},"WebDistribution":{"id":"WebDistribution","path":"RAG-Web-prod/WebDistribution","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.Distribution","version":"2.210.0","metadata":[]},"children":{"Origin1":{"id":"Origin1","path":"RAG-Web-prod/WebDistribution/Origin1","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"Resource":{"id":"Resource","path":"RAG-Web-prod/WebDistribution/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnDistribution","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::Distribution","aws:cdk:cloudformation:props":{"distributionConfig":{"enabled":true,"origins":[{"domainName":{"Fn::GetAtt":["WebBucket12880F5B","RegionalDomainName"]},"id":"RAGWebprodWebDistributionOrigin1AA2884DA","s3OriginConfig":{"originAccessIdentity":{"Fn::Join":["",["origin-access-identity/cloudfront/",{"Ref":"WebOAI6A7C4516"}]]}}},{"domainName":{"Fn::Join":["",[{"Fn::ImportValue":"RAG-API-prod:ExportsOutputRefRagApiDA20095C1B4F0205"},".execute-api.us-east-1.",{"Ref":"AWS::URLSuffix"}]]},"id":"RAGWebprodWebDistributionOrigin24050C02C","customOriginConfig":{"originSslProtocols":["TLSv1.2"],"originProtocolPolicy":"https-only"}}],"defaultCacheBehavior":{"pathPattern":"*","targetOriginId":"RAGWebprodWebDistributionOrigin1AA2884DA","allowedMethods":["GET","HEAD","OPTIONS"],"cachedMethods":["GET","HEAD","OPTIONS"],"cachePolicyId":{"Ref":"CachePolicy26D8A535"},"compress":true,"responseHeadersPolicyId":{"Ref":"ResponseHeadersPolicy13DBF9E0"},"viewerProtocolPolicy":"redirect-to-https"},"cacheBehaviors":[{"pathPattern":"/api/*","targetOriginId":"RAGWebprodWebDistributionOrigin24050C02C","allowedMethods":["GET","HEAD","OPTIONS","PUT","PATCH","POST","DELETE"],"cachePolicyId":"4135ea2d-6df8-44a3-9df3-4b5a84be39ad","compress":true,"originRequestPolicyId":"216adef6-5c7f-47e4-b989-5492eafa07d3","responseHeadersPolicyId":{"Ref":"ResponseHeadersPolicy13DBF9E0"},"viewerProtocolPolicy":"https-only"}],"comment":"RAG Web Application Distribution - RAG-Web-prod","customErrorResponses":[{"errorCachingMinTtl":10,"errorCode":404,"responseCode":200,"responsePagePath":"/index.html"},{"errorCachingMinTtl":10,"errorCode":403,"responseCode":200,"responsePagePath":"/index.html"}],"defaultRootObject":"index.html","httpVersion":"http2and3","ipv6Enabled":true,"priceClass":"PriceClass_100"},"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"Origin2":{"id":"Origin2","path":"RAG-Web-prod/WebDistribution/Origin2","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}},"WebDeployment":{"id":"WebDeployment","path":"RAG-Web-prod/WebDeployment","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_deployment.BucketDeployment","version":"2.210.0"},"children":{"AwsCliLayer":{"id":"AwsCliLayer","path":"RAG-Web-prod/WebDeployment/AwsCliLayer","constructInfo":{"fqn":"aws-cdk-lib.lambda_layer_awscli.AwsCliLayer","version":"2.210.0","metadata":[]},"children":{"Code":{"id":"Code","path":"RAG-Web-prod/WebDeployment/AwsCliLayer/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"RAG-Web-prod/WebDeployment/AwsCliLayer/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"RAG-Web-prod/WebDeployment/AwsCliLayer/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"RAG-Web-prod/WebDeployment/AwsCliLayer/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnLayerVersion","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::LayerVersion","aws:cdk:cloudformation:props":{"content":{"s3Bucket":"cdk-hnb659fds-assets-375004070918-us-east-1","s3Key":"c49d356cac773d491c5f7ac148995a1181498a8e289429f8612a7f7e3814f535.zip"},"description":"/opt/awscli/aws"}}}}},"CustomResourceHandler":{"id":"CustomResourceHandler","path":"RAG-Web-prod/WebDeployment/CustomResourceHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.210.0","metadata":[]}},"Asset1":{"id":"Asset1","path":"RAG-Web-prod/WebDeployment/Asset1","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"RAG-Web-prod/WebDeployment/Asset1/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"RAG-Web-prod/WebDeployment/Asset1/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Asset2":{"id":"Asset2","path":"RAG-Web-prod/WebDeployment/Asset2","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"RAG-Web-prod/WebDeployment/Asset2/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"RAG-Web-prod/WebDeployment/Asset2/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"CustomResource-512MiB-1024MiB":{"id":"CustomResource-512MiB-1024MiB","path":"RAG-Web-prod/WebDeployment/CustomResource-512MiB-1024MiB","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.210.0","metadata":[]},"children":{"Default":{"id":"Default","path":"RAG-Web-prod/WebDeployment/CustomResource-512MiB-1024MiB/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}}}},"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB":{"id":"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.210.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.210.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.210.0","metadata":[]}},"Resource":{"id":"Resource","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.210.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetBucket*","s3:GetObject*","s3:List*"],"Effect":"Allow","Resource":["arn:aws:s3:::cdk-hnb659fds-assets-375004070918-us-east-1","arn:aws:s3:::cdk-hnb659fds-assets-375004070918-us-east-1/*"]},{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["WebBucket12880F5B","Arn"]},"/*"]]}]},{"Action":["cloudfront:CreateInvalidation","cloudfront:GetInvalidation"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiBServiceRoleDefaultPolicy5878A191","roles":[{"Ref":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiBServiceRole5F7A526E"}]}}}}}}},"Code":{"id":"Code","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.210.0"},"children":{"Stage":{"id":"Stage","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.210.0"}},"AssetBucket":{"id":"AssetBucket","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.210.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"RAG-Web-prod/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiB/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.210.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-375004070918-us-east-1","s3Key":"9a1fcb4a7ecba81ad70e9d3fb241f6794497da945dae5f25924e4dd002b65f2d.zip"},"environment":{"variables":{"AWS_CA_BUNDLE":"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem"}},"ephemeralStorage":{"size":1024},"handler":"index.handler","layers":[{"Ref":"WebDeploymentAwsCliLayer79C1EFEA"}],"memorySize":512,"role":{"Fn::GetAtt":["CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C512MiB1024MiBServiceRole5F7A526E","Arn"]},"runtime":"python3.11","tags":[{"key":"ManagedBy","value":"CDK"},{"key":"Project","value":"RAG"},{"key":"Stage","value":"prod"},{"key":"Version","value":"V2"}],"timeout":900}}}}},"CloudFrontURL":{"id":"CloudFrontURL","path":"RAG-Web-prod/CloudFrontURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CloudFrontDistributionId":{"id":"CloudFrontDistributionId","path":"RAG-Web-prod/CloudFrontDistributionId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"S3BucketName":{"id":"S3BucketName","path":"RAG-Web-prod/S3BucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"OAIId":{"id":"OAIId","path":"RAG-Web-prod/OAIId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.210.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"RAG-Web-prod/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"RAG-Web-prod/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.210.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"RAG-Web-prod/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.210.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"RAG-Web-prod/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.210.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}